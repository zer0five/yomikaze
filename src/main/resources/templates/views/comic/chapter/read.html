<!DOCTYPE html>
<html lang="en" th:insert="layouts/default">
<head>
    <title th:fragment="page-title">comic::chapter::read</title>
</head>
<body @keydown.left="window.location.href = nextChapter"
      @keydown.right="window.location.href = prevChapter"
      th:data-next="@{/comic/{id}/chapter/{i}(id=${comic.id}, i=${index + 1})}"
      th:data-prev="@{/comic/{id}/chapter/{i}(id=${comic.id}, i=${index - 1})}"
      th:fragment="content"
      x-data="{ nextChapter: '{{nextChapter}}', prevChapter: '{{prevChapter}}' }"
      x-init="nextChapter = $el.dataset.next; prevChapter = $el.dataset.prev">
<!--preload-->
<link as="image" rel="preload" th:href="@{/asset/image/loading.svg}">
<p class="p-8 text-center">
    <a class="link text-lg font-bold" th:href="@{/comic/detail/{id}(id=${comic.id})}" th:text="${comic.name}"></a>
</p>

<div class="mb-12 pb-8 flex flex-col items-center"
     th:with="pages = ${chapter.getPages()}, page = ${pages.get(i)}">
    <!--/*@thymesVar id="page" type="org.yomikaze.persistence.entity.Page"*/-->
    <!--/*@thymesVar id="pages" type="java.util.List"*/-->
    <!--/*@thymesVar id="i" type="java.lang.Integer"*/-->
    <div class="w-full max-w-xl"
         th:each="i : ${#numbers.sequence(0, chapter.pages.size() - 1)}"
         x-data="{show: false}"
    >
        <img @load="show = true"
             alt="${page.index}"
             class="object-contain object-center mx-auto"
             th:alt="${i}"
             th:src="${page.uri}"
             x-init="show = $el.complete"
             x-show="show"
        >
        <img alt="${page.index}"
             class="object-contain object-center mx-auto my-12"
             th:alt="${index}"
             th:src="@{/asset/image/loading.svg}"
             x-show="!show">
    </div>
</div>

<div class="bottom-2 sticky btm-nav btm-nav-sm rounded-box shadow-2xl bg-base-300">
    <div class="px-2 flex flex-row gap-4">
        <button @click="window.location.href = prevChapter"
                class="btn btn-sm btn-circle hover:btn-accent focus:btn-accent active:btn-accent"
                th:disabled="${not chapters.hasPrevious()}">
            <i data-feather="chevron-left"></i>
        </button>
        <label>
            <select @change="window.location.href = $el.dataset.path + $el.value"
                    class="select select-sm grow sm:w-full sm:max-w-sm"
                    th:data-path="@{/comic/{id}/chapter/(id=${comic.id})}"
                    th:with="chs = ${chapters.toList()}"
            >
                <option
                    th:disabled="${ch.id == chapter.id}"
                    th:each="i : ${#numbers.sequence(0, chs.size() - 1)}"
                    th:selected="${ch.id == chapter.id}"
                    th:value="${i}"
                    th:with="ch = chs.get(i)"
                >
                    Chapter [[${i}]] - [[${ch.title}]]
                </option>
            </select>
        </label>
        <button @click="window.location.href = nextChapter"
                class="btn btn-sm btn-circle hover:btn-accent focus:btn-accent active:btn-accent"
                th:disabled="${not chapters.hasNext()}">
            <i data-feather="chevron-right"></i>
        </button>
    </div>
</div>

</body>
</html>
